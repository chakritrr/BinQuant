<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STREAK System Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .demo-card {
            transition: all 0.3s ease;
        }
        .demo-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }
        .streak-animation {
            animation: streakPulse 1s ease-in-out;
        }
        @keyframes streakPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen p-6">
        <!-- Header -->
        <div class="max-w-7xl mx-auto">
            <div class="text-center mb-8">
                <h1 class="text-4xl font-bold text-gray-800 mb-2">STREAK System Demo</h1>
                <p class="text-gray-600">ทดสอบระบบบริหารเงินแบบ STREAK</p>
            </div>

            <!-- Demo Controls -->
            <div class="bg-white rounded-xl shadow-sm p-6 mb-8">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Demo Controls</h2>
                <div class="flex flex-wrap gap-4">
                    <button id="simulateWin" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors">
                        <i class="fas fa-trophy mr-2"></i>Simulate WIN
                    </button>
                    <button id="simulateLoss" class="bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 transition-colors">
                        <i class="fas fa-times mr-2"></i>Simulate LOSS
                    </button>
                    <button id="resetDemo" class="bg-yellow-600 text-white px-6 py-3 rounded-lg hover:bg-yellow-700 transition-colors">
                        <i class="fas fa-refresh mr-2"></i>Reset Demo
                    </button>
                    <button id="autoDemo" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors">
                        <i class="fas fa-play mr-2"></i>Auto Demo
                    </button>
                </div>
            </div>

            <!-- STREAK Display -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <!-- Current STREAK -->
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">Current STREAK</h3>
                    <div class="text-center">
                        <div id="currentStreak" class="text-6xl font-bold text-blue-600 mb-4">0</div>
                        <div class="text-gray-600 mb-4">Current Order Value: $<span id="currentOrderValue">1.00</span></div>
                        <div class="text-sm text-gray-500">Streak <span id="streakNumber">1</span> of <span id="maxStreak">5</span></div>
                    </div>
                    
                    <!-- STREAK Progress -->
                    <div class="mt-6">
                        <div class="flex justify-between text-sm text-gray-600 mb-2">
                            <span>STREAK Progress</span>
                            <span id="streakProgress">0/5</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-3">
                            <div id="streakProgressBar" class="bg-blue-500 h-3 rounded-full transition-all duration-300" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <!-- STREAK Sizes -->
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">STREAK Sizes</h3>
                    <div id="streakSizes" class="space-y-3">
                        <!-- Streak sizes will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Statistics -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-xl shadow-sm p-6 demo-card">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm">Total Profit/Loss</p>
                            <p id="totalPnL" class="text-2xl font-bold text-green-600">$0.00</p>
                        </div>
                        <div class="bg-green-100 p-3 rounded-full">
                            <i class="fas fa-chart-line text-green-600 text-xl"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm p-6 demo-card">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm">Win Rate</p>
                            <p id="winRate" class="text-2xl font-bold text-blue-600">0%</p>
                        </div>
                        <div class="bg-blue-100 p-3 rounded-full">
                            <i class="fas fa-trophy text-blue-600 text-xl"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm p-6 demo-card">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm">Total Trades</p>
                            <p id="totalTrades" class="text-2xl font-bold text-gray-800">0</p>
                        </div>
                        <div class="bg-purple-100 p-3 rounded-full">
                            <i class="fas fa-exchange-alt text-purple-600 text-xl"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm p-6 demo-card">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm">Recovery Mode</p>
                            <p id="recoveryMode" class="text-2xl font-bold text-green-600">OFF</p>
                        </div>
                        <div class="bg-orange-100 p-3 rounded-full">
                            <i class="fas fa-shield-alt text-orange-600 text-xl"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Trade History -->
            <div class="bg-white rounded-xl shadow-sm">
                <div class="p-6 border-b border-gray-200">
                    <h3 class="text-xl font-semibold text-gray-800">Trade History</h3>
                </div>
                <div class="p-6">
                    <div id="tradeHistory" class="space-y-3">
                        <p class="text-gray-500 text-center">No trades yet</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        // Import STREAK system
        import { MoneyManagement } from '../src/utils/moneyManagement.js';

        class STREAKDemo {
            constructor() {
                this.moneyManagement = new MoneyManagement({
                    streakSizes: [1.0, 1.5, 2.5, 4.0, 6.5],
                    maxStreak: 5,
                    baseAmount: 1.0,
                    maxTotalLoss: 50.0,
                    maxDailyLoss: 20.0,
                    recoveryMode: true,
                    dynamicSizing: true,
                    volatilityAdjustment: true
                });
                
                this.autoDemoInterval = null;
                this.init();
            }

            init() {
                this.bindEvents();
                this.updateDisplay();
                this.renderStreakSizes();
            }

            bindEvents() {
                document.getElementById('simulateWin').addEventListener('click', () => {
                    this.simulateTrade('WIN');
                });

                document.getElementById('simulateLoss').addEventListener('click', () => {
                    this.simulateTrade('LOSS');
                });

                document.getElementById('resetDemo').addEventListener('click', () => {
                    this.resetDemo();
                });

                document.getElementById('autoDemo').addEventListener('click', () => {
                    this.toggleAutoDemo();
                });
            }

            simulateTrade(result) {
                const stats = this.moneyManagement.getStats();
                const currentValue = stats.currentOrderValue;
                
                // Simulate profit/loss
                let profitLoss;
                if (result === 'WIN') {
                    profitLoss = currentValue * (1 + Math.random() * 0.5); // 0-50% profit
                } else {
                    profitLoss = -currentValue * (0.5 + Math.random() * 0.5); // 50-100% loss
                }

                // Update STREAK
                const nextOrderValue = this.moneyManagement.updateStreak(result, profitLoss, {
                    orderId: `DEMO_${Date.now()}`,
                    timestamp: new Date()
                });

                // Update display with animation
                this.updateDisplay();
                this.addTradeToHistory(result, profitLoss, currentValue);
                
                // Animate streak change
                document.getElementById('currentStreak').classList.add('streak-animation');
                setTimeout(() => {
                    document.getElementById('currentStreak').classList.remove('streak-animation');
                }, 1000);
            }

            updateDisplay() {
                const stats = this.moneyManagement.getStats();
                const displayData = this.moneyManagement.getDisplayData();

                // Update current streak
                document.getElementById('currentStreak').textContent = stats.currentStreak;
                document.getElementById('currentOrderValue').textContent = displayData.currentOrderValue;
                document.getElementById('streakNumber').textContent = stats.currentStreak + 1;
                document.getElementById('maxStreak').textContent = stats.config.maxStreak;
                document.getElementById('streakProgress').textContent = `${stats.currentStreak + 1}/${stats.config.maxStreak}`;

                // Update progress bar
                const progressPercent = ((stats.currentStreak + 1) / stats.config.maxStreak) * 100;
                document.getElementById('streakProgressBar').style.width = `${progressPercent}%`;

                // Update statistics
                document.getElementById('totalPnL').textContent = `$${displayData.profitLoss}`;
                document.getElementById('totalPnL').className = `text-2xl font-bold ${parseFloat(displayData.profitLoss) >= 0 ? 'text-green-600' : 'text-red-600'}`;
                
                document.getElementById('winRate').textContent = `${displayData.winRate}%`;
                document.getElementById('totalTrades').textContent = displayData.totalTrades;
                
                const recoveryText = displayData.isRecoveryMode ? 'ON' : 'OFF';
                const recoveryColor = displayData.isRecoveryMode ? 'text-orange-600' : 'text-green-600';
                document.getElementById('recoveryMode').textContent = recoveryText;
                document.getElementById('recoveryMode').className = `text-2xl font-bold ${recoveryColor}`;

                // Update streak sizes display
                this.updateStreakSizesDisplay(stats.currentStreak);
            }

            renderStreakSizes() {
                const container = document.getElementById('streakSizes');
                const streakSizes = this.moneyManagement.config.streakSizes;
                
                container.innerHTML = streakSizes.map((size, index) => `
                    <div class="flex items-center justify-between p-3 rounded-lg border-2 transition-all duration-300" id="streak-${index}">
                        <div class="flex items-center">
                            <div class="w-4 h-4 rounded-full mr-3 bg-gray-300"></div>
                            <span class="font-medium">Streak ${index + 1}</span>
                        </div>
                        <div class="text-right">
                            <div class="font-bold text-gray-800">$${size.toFixed(2)}</div>
                            <div class="text-xs text-gray-500">Order Value</div>
                        </div>
                    </div>
                `).join('');
            }

            updateStreakSizesDisplay(currentStreak) {
                const streakSizes = this.moneyManagement.config.streakSizes;
                
                streakSizes.forEach((size, index) => {
                    const element = document.getElementById(`streak-${index}`);
                    const dot = element.querySelector('.w-4');
                    
                    if (index === currentStreak) {
                        element.classList.add('border-blue-500', 'bg-blue-50');
                        dot.classList.remove('bg-gray-300');
                        dot.classList.add('bg-blue-500');
                    } else if (index < currentStreak) {
                        element.classList.add('border-red-500', 'bg-red-50');
                        dot.classList.remove('bg-gray-300');
                        dot.classList.add('bg-red-500');
                    } else {
                        element.classList.remove('border-blue-500', 'bg-blue-50', 'border-red-500', 'bg-red-50');
                        dot.classList.remove('bg-blue-500', 'bg-red-500');
                        dot.classList.add('bg-gray-300');
                    }
                });
            }

            addTradeToHistory(result, profitLoss, orderValue) {
                const container = document.getElementById('tradeHistory');
                const tradeElement = document.createElement('div');
                
                tradeElement.className = 'flex items-center justify-between p-3 bg-gray-50 rounded-lg';
                tradeElement.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <div class="w-3 h-3 rounded-full ${result === 'WIN' ? 'bg-green-500' : 'bg-red-500'}"></div>
                        <div>
                            <div class="font-medium ${result === 'WIN' ? 'text-green-600' : 'text-red-600'}">
                                ${result}
                            </div>
                            <div class="text-sm text-gray-500">
                                ${new Date().toLocaleTimeString()}
                            </div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="font-semibold ${profitLoss >= 0 ? 'text-green-600' : 'text-red-600'}">
                            $${profitLoss.toFixed(2)}
                        </div>
                        <div class="text-sm text-gray-500">
                            Order: $${orderValue.toFixed(2)}
                        </div>
                    </div>
                `;

                // Add to top of history
                if (container.firstChild && container.firstChild.textContent === 'No trades yet') {
                    container.innerHTML = '';
                }
                container.insertBefore(tradeElement, container.firstChild);

                // Limit history to 10 items
                const historyItems = container.children;
                if (historyItems.length > 10) {
                    container.removeChild(historyItems[historyItems.length - 1]);
                }
            }

            resetDemo() {
                if (confirm('Are you sure you want to reset the demo? This will clear all statistics.')) {
                    this.moneyManagement.reset();
                    this.updateDisplay();
                    document.getElementById('tradeHistory').innerHTML = '<p class="text-gray-500 text-center">No trades yet</p>';
                    this.renderStreakSizes();
                }
            }

            toggleAutoDemo() {
                const button = document.getElementById('autoDemo');
                
                if (this.autoDemoInterval) {
                    clearInterval(this.autoDemoInterval);
                    this.autoDemoInterval = null;
                    button.innerHTML = '<i class="fas fa-play mr-2"></i>Auto Demo';
                    button.classList.remove('bg-red-600', 'hover:bg-red-700');
                    button.classList.add('bg-blue-600', 'hover:bg-blue-700');
                } else {
                    this.autoDemoInterval = setInterval(() => {
                        const result = Math.random() > 0.6 ? 'WIN' : 'LOSS'; // 40% win rate
                        this.simulateTrade(result);
                    }, 2000);
                    
                    button.innerHTML = '<i class="fas fa-stop mr-2"></i>Stop Auto';
                    button.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                    button.classList.add('bg-red-600', 'hover:bg-red-700');
                }
            }
        }

        // Initialize demo
        const demo = new STREAKDemo();
    </script>
</body>
</html> 